<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<!-- 先引入 jquery的 js -->
	<script type="text/javascript" src="easyui/js/jquery-1.8.0.min.js">
	</script>
	<!-- 引入 easyui的js -->
	<script type="text/javascript" src="easyui/js/jquery.easyui.min.js"></script>
	<!-- 引入国际化 js -->
	<script type="text/javascript" src="easyui/js/locale/easyui-lang-zh_CN.js"></script>
	<!-- 引入 默认样式 css -->
	<link rel="stylesheet" type="text/css" href="easyui/js/themes/default/easyui.css" />
	<!-- 引入 icon图标 css  -->
	<link rel="stylesheet" type="text/css" href="easyui/js/themes/icon.css" />
	<link rel="stylesheet" type="text/css" href="easyui/ztree/zTreeStyle.css" />
	<script type="text/javascript" src="easyui/ztree/jquery.ztree.all-3.5.js"></script>
	<link rel="stylesheet" type="text/css" href="css/center.css" />
	<title>Insert title here</title>
</head>

<body class="easyui-layout">
	<div id="searchWin" class="easyui-window" title="查询药品入库记录" data-options="iconCls:'icon-search',modal:true" closed="true" maximizable="false"
	 style="" collapsible="true" minimizable="true">

		<div region="center">
			<div class="easyui-panel" title="" style="width:400px"></div>

			<table cellpadding="5">
				<tr>
					<td>入库ID:</td>
					<td>
						<input id="rKID" class="easyui-textbox" type="text" name="rKID" data-options="required:true" />
					</td>
				</tr>
				<tr>
					<td>药品编码：</td>
					<td>
						<input id="yPBN" class="easyui-textbox" type="text" name="yPBM" data-options="required:true,validType:'email'" />
					</td>
				</tr>
				<tr>
					<td>药品名称：</td>
					<td>
						<input id="yPMC" class="easyui-textbox" type="text" name="yPMC" data-options="required:true,validType:'email'" />
					</td>
				</tr>

				<tr>
					<td>入库量:</td>
					<td>
						<input id="rKL1" class="easyui-textbox" type="text" name="rKL1" data-options="required:true" />
					</td>
				</tr>
				<tr>
					<td>入库量:</td>
					<td>
						<input id="rKL2" class="easyui-textbox" type="text" name="rKL2" data-options="required:true" />
					</td>
				</tr>
				<tr>
					<td>职工编码:</td>
					<td>
						<input id="zGBM" class="easyui-textbox" type="text" name="zGBM" data-options="required:true" />
					</td>
				</tr>

				<tr>
					<td>入库日期(开始):</td>
					<td>
						<input id="rKRQ1" class="easyui-datetimebox" type="text" name="rKRQ1" data-options="required:true" />
					</td>
				</tr>
				<tr>
					<td>入库日期(结束):</td>
					<td>
						<input id="rKRQ2" class="easyui-datetimebox" type="text" name="rKRQ2" data-options="required:true" />
					</td>
				</tr>



			</table>
			<input id="page" name="page" value="1" type="hidden" />
			<button href="#" class="easyui-linkbutton"  type="submit" id="search">查找</button>
		

		</div>

	</div>
	<div id="updateWin" class="easyui-window" title="修改入库记录" data-options="iconCls:'icon-save',modal:true" closed="true" maximizable="false"
	 style="" collapsible="true" minimizable="true">
		<form action="updateRkxx">
			<div region="center">
				<div class="easyui-panel" title="" style="width:400px"></div>

				<table cellpadding="5">
					<tr>
						<td>入库id:</td>
						<td>
							<input id="rKID" class="easyui-textbox" type="text" name="rKID" data-options="required:true" />
						</td>
					</tr>
					<tr>
						<td>药品编码:</td>
						<td>
							<input id="yPBM" class="easyui-textbox" type="text" name="yPBM" data-options="required:true" />
							<!-- <input id="yPBM" class="easyui-combobox" name="yPBM"
							data-options="valueField:'yPBM',textField:'yPBM',url:'findAllYpxx'"> -->
						</td>
					</tr>
					<tr>
						<td>药品名称：</td>
						<td>
							<input id="yPMC" class="easyui-textbox" type="text" name="yPMC" data-options="required:true,validType:'email'" />
						</td>
					</tr>
					<tr>
						<td>入库量:</td>
						<td>
							<input id="rKL" class="easyui-textbox" type="text" name="rKL" data-options="required:true" />
						</td>
					</tr>
					<tr>
						<td>职工编码:</td>
						<td>
							<input id="zGBM" class="easyui-textbox" type="text" name="zGBM" data-options="required:true" />
						</td>
					</tr>
					<tr>
						<td>入库效期:</td>
						<td>
							<input id="rKRQ" class="easyui-datetimebox" type="text" name="rKRQ" data-options="required:true" />
						</td>
					</tr>
				</table>
				<input id="page" name="page" value="1" type="hidden" />
				<button href="#" class="easyui-linkbutton"  type="submit" id="search">修改</button>
			

			</div>
		</form>

	</div>
	<div id="addWin" class="easyui-window" title="添加入库记录" data-options="iconCls:'icon-add',modal:true" closed="true" maximizable="false"
	 style="" collapsible="true" minimizable="true">
		<form action="addRkxx">
			<div region="center">
				<div class="easyui-panel" title="" style="width:400px"></div>

				<table cellpadding="5">
					<!-- <tr>
						<td>入库id:</td>
						<td>
							<input id="rKID" class="easyui-textbox" type="text" name="rKID" data-options="required:true" />
						</td>
					</tr> -->
					<tr>
						<td>药品编码:</td>
						<td>
							<input id="yPBM" class="easyui-textbox" type="text" name="yPBM" data-options="required:true" /><label id="checkYPBM"></label>
						</td>
					</tr>
					<tr>
						<td>药品名称：</td>
						<td>
							<input id="yPMC" class="easyui-textbox" type="text" name="yPMC" data-options="required:true,validType:'email'" />
						</td>
					</tr>
					<tr>
						<td>入库量:</td>
						<td>
							<input id="rKL" class="easyui-textbox" type="text" name="rKL" data-options="required:true" />
						</td>
					</tr>
					<tr>
						<td>职工编码:</td>
						<td>
							<input id="zGBM" class="easyui-textbox" type="text" name="zGBM" data-options="required:true" />
						</td>
					</tr>
					<tr>
						<td>入库效期:</td>
						<td>
							<input id="rKRQ" class="easyui-datetimebox" type="text" name="rKRQ" data-options="required:true" />
						</td>
					</tr>
				</table>
				<input id="page" name="page" value="1" type="hidden" />
				<button href="#" class="easyui-linkbutton"  type="submit" id="search">增加</button>
			

			</div>
		</form>

	</div>

	<div region="center" style="height:400px">
		<form action="delRkxx" method="get" id="delForm" style="height:400px">
			<table id="dg" class="easyui-datagrid"></table>
			<input name="ids" id="ids" type="hidden" />
		</form>
	</div>



</body>
<script>
	function myformatter(date) {
		var y = date.getFullYear();
		var m = date.getMonth() + 1;
		var d = date.getDate();
		return y + '-' + (m < 10 ? ('0' + m) : m) + '-' + (d < 10 ? ('0' + d) : d);
	}

	function myparser(s) {
		if (!s) return new Date();
		var ss = (s.split('-'));
		var y = parseInt(ss[0], 10);
		var m = parseInt(ss[1], 10);
		var d = parseInt(ss[2], 10);
		if (!isNaN(y) && !isNaN(m) && !isNaN(d)) {
			return new Date(y, m - 1, d);
		} else {
			return new Date();
		}
	}
	function arrayToString(array, zd) {
		var sum = '';
		for (var i = 0; i < array.length; ++i) {
			sum = sum + array[i][zd];
			if (i < array.length - 1)
				sum = sum + ',';
		}
		return sum;
	}

</script>
<script>
	var curr_time = new Date();
	//	$('#yXRQ1').datebox('setValue', myformatter(curr_time));	
	//	$('#yXRQ2').datebox('setValue', myformatter(curr_time));	

	function doSearch() {
		$('#dg').datagrid('load', {
			good: '11'
		});
	}
	function doDelete() {
		// 先判断 用户是否选择
		var array = $('#dg').datagrid('getSelections');
		if(array==null||array.length==0){
		  $.messager.alert('警告','请选择删除的列','info');
				return;
				}
		var ids = arrayToString(array, 'rKID');
		if(confirm("确定删除？")){
			$('#ids').val(ids);
			$("#delForm").submit();
			}
	}
	var editrow = undefined;
	$('#dg').datagrid({
		fit: true,
		url: 'Rkxx',
		pagePosition: "bottom",
		border: false,
		rownumbers: true,
		columns: [[
			{
				field: 'rKID',
				title: '入库id',
				checkbox: true,
				width: 100
			},
			{
				field: 'yPBM',
				title: '药品编码',
				width: 100

			},
			{
				field: 'yPMC',
				title: '药品名称',
				width: 100


			},
			{
				field: 'rKL',
				title: '入库量',
				width: 100

			},
			{
				field: 'zGBM',
				title: '职工编码',
				width: 200
			},
			{
				field: 'rKRQ',
				title: '入库日期',
				width: 200,
				formatter: function (value, row, index) {
					if(value==null) return null;
					var unixTimestamp = new Date(value.time);
					return unixTimestamp.toLocaleString();
				}
			}
		]],
		queryParams: {
			rKID: $("#rKID").val(),
			yPBM: $("#yPBM").val(),
			yPMC: $("#yPMC").val(),
			rKL1: $('#rKL1').val(),
			rKL2: $('#rKL2').val(),
			zGBM: $('#zGBM').val(),
			rKRQ1: $('#rKRQ1').val(),
			rKRQ2: $('#rKRQ2').val()
		},
		toolbar: [{
			iconCls: 'icon-add',
			handler: function () {
				$("#addWin").window('open')
			}
		},  {
			iconCls: 'icon-cancel',
			handler: function () {
				doDelete();
			}
		}, {
			iconCls: 'icon-search',
			handler: function () {
				$("#searchWin").window('open');
			}
		}],
		pageList: [5, 10],
		idField: "rKID",
		pagination: true,
		onDblClickRow: function (rowIndex, rowData) {
			$("#updateWin").window('open');
			$('#updateWin #rKID').val(rowData.rKID)
			$('#updateWin #yPBM').val(rowData.yPBM)
			$('#updateWin #yPMC').val(rowData.yPMC)
			$('#updateWin #zGBM').val(rowData.zGBM)
			$('#updateWin #rKL').val(rowData.rKL)
			var unixTimestamp = new Date(rowData.rKRQ.time);

			$('#updateWin #rKRQ').datebox('setValue', unixTimestamp.toLocaleString());

		}

	});
</script>
<script type="text/javascript">
	$('#search').click(function () {
		console.log($('#rKRQ1').val())
		$('#dg').datagrid('load', {
			rKID: $("#rKID").val(),
			yPBM: $("#yPBM").val(),
			yPMC: $("#yPMC").val(),
			rKL1: $('#rKL1').val(),
			rKL2: $('#rKL2').val(),
			zGBM: $('#zGBM').val(),
			rKRQ1: $('#rKRQ1').datebox('getValue'),
			rKRQ2: $('#rKRQ2').datebox('getValue')
		});
	})
</script>
<script>
//检查药品编码
$("#addWin #yPBM").blur(function (e) { 
	e.preventDefault();
	$.ajax({
		type: "GET",
		url: "checkypbm",
		data: "yPBM="+$('#addWin #yPBM').val(),
		success: function (response) {
			$('#addWin #yPMC').val(response)
		}
	});
});

	



</script>

</html>